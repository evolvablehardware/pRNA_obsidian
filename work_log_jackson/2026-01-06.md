## Log
- Meeting
- Finished linting sql, fixed everything that broke as a result
- Moved database classes to linted sql
- Updated WorkerDatabase to use database methods
- Made util functions for writing tests with pytest
## Next
- Reservation time endpoints
- Increase test coverage
	- Current testing works pretty well if something important gets broken, need to individually test util control/worker apis for managing reservations. 
- Add some events to control socket
	- Want to notify clients when devices become available
	- Planning to use postgres listen/notify to do this. Should move much of heartbeat functionality to do this too. 
- Fix heartbeat issue - need to include worker id since using network=host, restarting a container can cause old worker entry to persist
	- Planning on trying remove this flag again. It makes networking between services annoying. I really want to switch to ELK for logging, as this will let us do analytics stuff, but not going to do that until this gets resolved. 
- Fix client install from pip?
	- Should really just make this a separate module instead. Still deciding whether I want to have 3 modules under one src or worker/control on one and client on another
- Improve pulsecount state/client 
	- Add evaluation time arg
	- Add configuration option for amount of batched evaluations to queue before flushing instead of waiting for all to be completed
	- Turn evaluate functions into generators 
	- Make evaluate threadsafe
	- Add more evaluation options - evaluate amount of times across different devices, ensure distribution is randomized when sending to multiple devices 
		- Should do some refactoring inside client in regards to how requests are distributed. Originally, the plan was that the client object would be inherited from and the user would define the distribution methods they want to use. I think its probably better to define a distribution method interface. 
	- Move batching inside client 
	- Make state more robust, timeout detection on circuit evaluations. I'm hesitant to spend too much time on this, since the pulse count evaluation behavior on the firmware is currently hacked together. 
- Look into python 3.13. This version has an experimental feature to disable the GIL. Not sure how IO bound our operations are, but the worker is pretty massively threaded. This feature breaks the atomic guarantee on c bindings however, so there is a good chance that the libraries we use will not support doing this. 

[[work_log_jackson/2026-01-05|prev]] [[work_log_jackson/2026-01-07|next]]
