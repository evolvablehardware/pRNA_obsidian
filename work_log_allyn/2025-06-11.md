## Log
### Memory Usage in Warm Boot Configuration
Worked on trying to understand where the warmboot images are stored in memory. [This technical note, pg. 14](https://www.workver.com/wv/FPGA/iCE40ProgrammingandConfiguration.pdf) on programming and configuration suggests they are being stored in read-only memory. ![[Pasted image 20250610130742.png]]
However, the warmboot application is able to modify the SPI Flash to control which bitstream is swapped to. I'm not entirely sure where bitstreams are stored when they are not being the one swapped to. Apparently "read-only" is a bit of a misnomer in this case, as the flash can be reprogrammed using things such as JTAG programmer or USB blaster.

[[Fritzsch2022]] (background section) suggests the the configuration data is stored in RAM:
>Like most modern FPGAs, iCE40 devices are based on SRAM cells. The SRAM, in turn, is split between configuration memory (CRAM) and block RAM. BRAM represents only the contents of the embedded memory, while CRAM represents every other aspect of the configuration. CRAM and BRAM are each split in four banks. Each of which correspond to a quadrant of the iCE40 physical chip.

They then say:
>During the configuration process, the chip clears the whole CRAM while the BRAM is left unchanged [15]. Afterwards the bitstream is loaded into the FPGA.

Which contradicts [the technical note, pg. 2](https://www.workver.com/wv/FPGA/iCE40ProgrammingandConfiguration.pdf)
> At the beginning of the configuration, all the SRAM has been cleared to â€œ0"

[[umarcor2021]] For loading a single bitstream:
>That is, in the iCEstick and similar boards, the FTDI resets the FPGA by asserting `CRESET_B` and lets it power up in slave SPI mode by keeping `SPI_SS_B` low. Then, the image is written to the SRAM directly.

However, with a different command (not shown):
>This time, the FTDI explicitly holds the FPGA in reset state and asserts the chip select signal of the flash memory. Then, the image is written to the flash memory. When the transference is complete, the reset state is released and the FPGA is powered up in master SPI mode. Therefore, the image written just before is loaded from the flash memory. For more information check [TN1248, pp 10-13].

[[Fritzsch2022]] does not mention SPI at all. I'm guessing that they just abstracted it out as is not relevant to compactifying the bitstream. 
## Next
- [ ]

[[2025-06-10|prev]] [[2025-06-12|next]]
