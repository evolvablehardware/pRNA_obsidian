## Log
### Controller Debugging and Improvements
I met with Logan to help him finish setting up the memory controller and verify its working on his setup.

While I was helping him set up, we discovered a bug where some of the hex data files are not generated at the correct length. I'm not entirely sure what was causing this, but I made the makefile a bit more robust and made it so that the python program would not crash and warn the user.

I cleaned up the top level of the project some and renamed it to top.v. I wrapped the controller, uart, and warmboot modules into uart_controller, so it's more clear what modules are separate from the neural network.

I added in the ability for the user to specify which warmboot slot they want to switch to when warmbooting (using the 2 least significant bits of the command byte). When testing this, I ran into issues when trying to warmboot more than 2 images on the pico. It seems lie the resulting bitstream file is too large:
```
/usr/lib/gcc/arm-none-eabi/10.3.1/../../../arm-none-eabi/bin/ld: rp2_ice_bram_controller.elf section `.data' will not fit in region `RAM'
/usr/lib/gcc/arm-none-eabi/10.3.1/../../../arm-none-eabi/bin/ld: section .stack1_dummy VMA [0000000020040000,00000000200407ff] overlaps section .data VMA [00000000200000c0,000000002005b847]
/usr/lib/gcc/arm-none-eabi/10.3.1/../../../arm-none-eabi/bin/ld: region `RAM' overflowed by 120092 bytes
collect2: error: ld returned 1 exit status
```

I'm not sure how much I can do about that, so I'm just working with warmbooting the controller with one image for now. 
### Attempted Warmboot Demo
My [simple demo](https://github.com/evolvablehardware/ice40_memory_controller/blob/warmboot_demo/src_verilog/warmboot_demo.v) lights up the LEDs with the 3 least significant bits of the first address in memory. After 5 seconds (assuming 48MHz clock speed), it warmboots back to the controller.

I got this working on the HX1K device, with the only caveat being that you have to send the reset signal for the state machine after each warmboot.

When I tried on the UP5K device (specifically the pico1), it didn't work. Always, the blue led turned on and then stayed on (even after 5 seconds). However, I was able to still sync the device. So it might not have been warmbooting at all, and just changing state.

I'm pretty sure the issue is what we're writing directly to CRAM, and not the SPI flash. This might also explain the above error. [Here](https://pico-ice.tinyvision.ai/group__ice__flash.html) is the documentation on the `ice_flash` functions. I'm not sure how much will be possible to get done tomorrow, but it might be feasible to get a simple warmboot example working. 
## Next
- See if I can get warmbooting working on the picos using `ice_flash` functions. It would be nice to be able to time how long warmbooting takes.

[[2025-08-06|prev]] [[2025-08-08|next]]
